<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Fluxo de Caixa</title>
    <!-- Carregar Chart.js v3 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- Carregar plugin de anotação -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.1/dist/chartjs-plugin-annotation.min.js"></script>
</head>
<body>
    <h1>Simulador de Fluxo de Caixa</h1>
    <form>
        <label>Preço Unitário (R$):</label>
        <input type="number" id="precoUnitario" value="73" step="0.01"><br><br>
        <label>Quantidade (Caixas):</label>
        <input type="number" id="quantidade" value="1000"><br><br>
        <label>Prazo de Pagamento (dias):</label>
        <input type="number" id="prazoPagamento" value="28"><br><br>
        <label>Vendas Diárias (caixas):</label>
        <input type="number" id="vendasDiarias" value="20"><br><br>
        <label>Margem de Lucro (%):</label>
        <input type="number" id="margemLucro" value="5" step="0.1"><br><br>
        <button type="button" onclick="gerarGrafico()">Gerar Gráfico</button>
    </form>

    <canvas id="grafico" width="1000" height="500"></canvas>

    <script>
    function gerarGrafico() {
        // Registrar plugin de anotação
        if (Chart.register) {
            Chart.register(ChartAnnotation);
        }

        // Capturar valores do formulário
        const precoUnitario = parseFloat(document.getElementById('precoUnitario').value);
        const quantidade = parseInt(document.getElementById('quantidade').value);
        const prazoPagamento = parseInt(document.getElementById('prazoPagamento').value);
        const vendasDiarias = parseFloat(document.getElementById('vendasDiarias').value);
        const margemLucro = parseFloat(document.getElementById('margemLucro').value) / 100;

        // Cálculo do preço de venda com margem
        const precoVendaComMargem = precoUnitario * (1 + margemLucro);
        const dataInicio = new Date(2025, 1, 1);
        const dataPagamento = new Date(dataInicio);
        dataPagamento.setDate(dataInicio.getDate() + prazoPagamento);
        const dataPagamentoLabel = dataPagamento.toISOString().split('T')[0];

        // Arrays de dados
        const datas = [];
        const estoque = [];
        const fluxoCaixa = [];
        const estoqueMargem = [];
        const fluxoCaixaMargem = [];

        // Variáveis de simulação
        let estoqueAtual = quantidade;
        let caixaAcumulado = 0;
        let estoqueAtualMargem = quantidade;
        let caixaAcumuladoMargem = 0;

        // Gerar dados para 60 dias
        for (let dia = 0; dia < 60; dia++) {
            const dataAtual = new Date(dataInicio);
            dataAtual.setDate(dataInicio.getDate() + dia);
            const dataStr = dataAtual.toISOString().split('T')[0];
            datas.push(dataStr);

            // Vendas sem margem adicional
            if (estoqueAtual > 0) {
                const vendidos = Math.min(vendasDiarias, estoqueAtual);
                estoqueAtual -= vendidos;
                caixaAcumulado += vendidos * precoUnitario;
            }
            // Pagamento do fornecedor
            if (dataStr === dataPagamentoLabel) {
                caixaAcumulado -= precoUnitario * quantidade;
            }
            estoque.push(estoqueAtual);
            fluxoCaixa.push(caixaAcumulado);

            // Vendas com margem de lucro
            if (estoqueAtualMargem > 0) {
                const vendidosM = Math.min(vendasDiarias, estoqueAtualMargem);
                estoqueAtualMargem -= vendidosM;
                caixaAcumuladoMargem += vendidosM * precoVendaComMargem;
            }
            if (dataStr === dataPagamentoLabel) {
                caixaAcumuladoMargem -= precoUnitario * quantidade;
            }
            estoqueMargem.push(estoqueAtualMargem);
            fluxoCaixaMargem.push(caixaAcumuladoMargem);
        }

        // Criar gráfico
        const ctx = document.getElementById('grafico').getContext('2d');
        if (window.graficoAtivo) window.graficoAtivo.destroy();
        window.graficoAtivo = new Chart(ctx, {
            type: 'line',
            data: {
                labels: datas,
                datasets: [
                    { label: 'Estoque (Venda Constante)', data: estoque, borderColor: 'blue', yAxisID: 'y' },
                    { label: 'Fluxo de Caixa (Venda Constante)', data: fluxoCaixa, borderColor: 'green', yAxisID: 'y1' },
                    { label: 'Estoque (Margem 5%)', data: estoqueMargem, borderColor: 'purple', yAxisID: 'y' },
                    { label: 'Fluxo de Caixa (Margem 5%)', data: fluxoCaixaMargem, borderColor: 'brown', yAxisID: 'y1' }
                ]
            },
            options: {
                plugins: {
                    annotation: {
                        annotations: {
                            linhaPagamento: {
                                type: 'line',
                                scaleID: 'x',
                                value: dataPagamentoLabel,
                                borderColor: 'red',
                                borderWidth: 2,
                                label: {
                                    enabled: true,
                                    content: 'Data Pagamento',
                                    position: 'start'
                                }
                            }
                        }
                    }
                },
                scales: {
                    x: { type: 'category', title: { display: true, text: 'Data' } },
                    y: { title: { display: true, text: 'Estoque (Caixas)' } },
                    y1: { position: 'right', title: { display: true, text: 'Fluxo de Caixa (R$)' }, grid: { drawOnChartArea: false } }
                }
            }
        });
    }
    </script>
</body>
</html>


