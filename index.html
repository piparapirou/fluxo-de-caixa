<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Fluxo de Caixa</title>
    <!-- Carrega Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Simulador de Fluxo de Caixa</h1>

    <form id="formulario">
        <label>Preço Unitário (R$):</label>
        <input type="number" id="precoUnitario" value="73" step="0.01"><br><br>

        <label>Quantidade (Caixas):</label>
        <input type="number" id="quantidade" value="1000"><br><br>

        <label>Prazo de Pagamento (dias):</label>
        <input type="number" id="prazoPagamento" value="28"><br><br>

        <label>Vendas Diárias (caixas):</label>
        <input type="number" id="vendasDiarias" value="20"><br><br>

        <label>Margem de Lucro (%):</label>
        <input type="number" id="margemLucro" value="5" step="0.1"><br><br>

        <label>Caixa Inicial (R$):</label>
        <input type="number" id="caixaInicial" value="0" step="0.01"><br><br>

        <button type="button" onclick="gerarGrafico()">Gerar Gráfico</button>
    </form>

    <canvas id="grafico" width="1000" height="500"></canvas>

    <script>
    function gerarGrafico() {
        const precoUnitario = parseFloat(document.getElementById('precoUnitario').value);
        const quantidade = parseInt(document.getElementById('quantidade').value);
        const prazoPagamento = parseInt(document.getElementById('prazoPagamento').value);
        const vendasDiarias = parseFloat(document.getElementById('vendasDiarias').value);
        const margemLucro = parseFloat(document.getElementById('margemLucro').value) / 100;
        const caixaInicial = parseFloat(document.getElementById('caixaInicial').value);

        const precoVendaComMargem = precoUnitario * (1 + margemLucro);
        const dataInicio = new Date(2025, 1, 1);
        let datas = [];
        let estoqueMargem = [];
        let fluxoCaixaMargem = [];

        let estoqueAtualMargem = quantidade;
        let caixaAcumuladoMargem = caixaInicial;

        for (let dia = 0; dia < 60; dia++) {
            const dataAtual = new Date(dataInicio);
            dataAtual.setDate(dataInicio.getDate() + dia);
            const dataStr = dataAtual.toISOString().split('T')[0];
            datas.push(dataStr);

            // Vendas com margem de lucro
            if (estoqueAtualMargem > 0) {
                const vendidosM = Math.min(vendasDiarias, estoqueAtualMargem);
                estoqueAtualMargem -= vendidosM;
                caixaAcumuladoMargem += vendidosM * precoVendaComMargem;
            }
            // Pagamento do fornecedor
            if (dia === prazoPagamento) {
                caixaAcumuladoMargem -= precoUnitario * quantidade;
            }
            estoqueMargem.push(estoqueAtualMargem);
            fluxoCaixaMargem.push(caixaAcumuladoMargem);
        }

        const ctx = document.getElementById('grafico').getContext('2d');
        if (window.graficoAtivo) window.graficoAtivo.destroy();
        window.graficoAtivo = new Chart(ctx, {
            type: 'line',
            data: {
                labels: datas,
                datasets: [
                    {
                        label: `Fluxo de Caixa (Margem ${margemLucro * 100}%)`,
                        data: fluxoCaixaMargem,
                        borderColor: 'green',
                        yAxisID: 'y1'
                    },
                    {
                        label: `Estoque (Margem ${margemLucro * 100}%)`,
                        data: estoqueMargem,
                        borderColor: 'purple',
                        yAxisID: 'y'
                    }
                ]
            },
            options: {
                scales: {
                    x: { type: 'category', title: { display: true, text: 'Data' } },
                    y: { title: { display: true, text: 'Estoque (Caixas)' } },
                    y1: { position: 'right', title: { display: true, text: 'Fluxo de Caixa (R$)' }, grid: { drawOnChartArea: false } }
                }
            }
        });
    }
    </script>
</body>
</html>
