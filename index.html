<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Fluxo de Caixa com Valorização de Estoque</title>
    <!-- Carrega Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Simulador de Fluxo de Caixa</h1>

    <form id="formulario">
        <label>Preço Unitário (R$):</label>
        <input type="number" id="precoUnitario" value="73" step="0.01"><br><br>

        <label>Quantidade (Caixas):</label>
        <input type="number" id="quantidade" value="1000"><br><br>

        <label>Prazo de Pagamento (dias):</label>
        <input type="number" id="prazoPagamento" value="28"><br><br>

        <label>Vendas Diárias (caixas):</label>
        <input type="number" id="vendasDiarias" value="20"><br><br>

        <label>Margem de Lucro (% sobre custo):</label>
        <input type="number" id="margemLucro" value="5" step="0.1"><br><br>

        <label>Caixa Inicial (R$):</label>
        <input type="number" id="caixaInicial" value="0" step="0.01"><br><br>

        <label>Taxa Básica de Juros Anual (%):</label>
        <input type="number" id="taxaJuros" value="10" step="0.01"><br><br>

        <button type="button" onclick="gerarGrafico()">Gerar Gráfico</button>
    </form>

    <canvas id="grafico" width="1000" height="500"></canvas>

    <script>
    function gerarGrafico() {
        // Captura valores do formulário
        const precoUnitario = parseFloat(document.getElementById('precoUnitario').value);
        const quantidade = parseInt(document.getElementById('quantidade').value);
        const prazoPagamento = parseInt(document.getElementById('prazoPagamento').value);
        const vendasDiarias = parseFloat(document.getElementById('vendasDiarias').value);
        const margem = parseFloat(document.getElementById('margemLucro').value) / 100;
        const caixaInicial = parseFloat(document.getElementById('caixaInicial').value);
        const taxaAnual = parseFloat(document.getElementById('taxaJuros').value) / 100;

        // Taxa diária aproximada
        const taxaDiaria = taxaAnual / 365;

        // Preço de venda sem juros
        // Cálculo será ajustado por juros para cada dia

        // Datas e arrays de dados
        const datas = [];
        const estoque = [];
        const valorEstoque = [];
        const fluxoCaixa = [];

        // Variáveis de simulação
        let estoqueAtual = quantidade;
        let caixaAcumulado = caixaInicial;

        // Data de início: 1 de fevereiro de 2025
        const dataInicio = new Date(2025, 1, 1);

        for (let dia = 0; dia < 60; dia++) {
            // Data atual e label
            const dataAtual = new Date(dataInicio);
            dataAtual.setDate(dataInicio.getDate() + dia);
            const dataStr = dataAtual.toISOString().split('T')[0];
            datas.push(dataStr);

            // Calcula valorização do estoque pelo juro diário
            const valorUnidadeComJuros = precoUnitario * Math.pow(1 + taxaDiaria, dia);
            valorEstoque.push(estoqueAtual * valorUnidadeComJuros);

            // Vendas a partir do dia seguinte
            if (dia > 0 && estoqueAtual > 0) {
                const vendidos = Math.min(vendasDiarias, estoqueAtual);
                estoqueAtual -= vendidos;
                // Preço de venda com margem e juros
                const precoVendaUnitario = valorUnidadeComJuros * (1 + margem);
                caixaAcumulado += vendidos * precoVendaUnitario;
            }

            // Pagamento do fornecedor no prazo
            if (dia === prazoPagamento) {
                caixaAcumulado -= precoUnitario * quantidade;
            }

            estoque.push(estoqueAtual);
            fluxoCaixa.push(caixaAcumulado);
        }

        // Desenha o gráfico
        const ctx = document.getElementById('grafico').getContext('2d');
        if (window.graficoAtivo) window.graficoAtivo.destroy();
        window.graficoAtivo = new Chart(ctx, {
            type: 'line',
            data: {
                labels: datas,
                datasets: [
                    {
                        label: 'Fluxo de Caixa (R$)',
                        data: fluxoCaixa,
                        borderColor: 'green',
                        yAxisID: 'y1'
                    },
                    {
                        label: 'Estoque (caixas)',
                        data: estoque,
                        borderColor: 'purple',
                        yAxisID: 'y'
                    },
                    {
                        label: 'Valor Estoque (R$)',
                        data: valorEstoque,
                        borderColor: 'orange',
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                scales: {
                    x: { type: 'category', title: { display: true, text: 'Data' } },
                    y: { title: { display: true, text: 'Estoque (caixas)' } },
                    y1: { position: 'right', title: { display: true, text: 'Valor / Fluxo de Caixa (R$)' }, grid: { drawOnChartArea: false } }
                }
            }
        });
    }
    </script>
</body>
</html>

